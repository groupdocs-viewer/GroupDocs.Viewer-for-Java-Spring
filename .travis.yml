dist: trusty
language: java
jdk:
- oraclejdk8
- oraclejdk9
- openjdk8
- oraclejdk11
- openjdk10
- openjdk11
services:
  - docker
jobs:
  include:
  - stage: Tag Release
    if: type = push AND branch = release-publishing AND commit_message !~ /^Travis bot released/
    install: skip
    script: git checkout release-publishing && git reset --hard $sha1 && git config --global push.followTags true && git config --global user.email "travis@travis-ci.org" && git config --global user.name "Travis CI" && export current_version=$(mvn -q -Dexec.executable="echo" -Dexec.args='${project.version}' --non-recursive exec:exec) && echo "current version ${current_version}" && export minor=$(echo $current_version | sed "s/^[0-9]\{1,\}\.[0-9]\{1,\}\.\([0-9]\{1,\}\)/\1/") && export major=$(echo $current_version | sed "s/^\([0-9]\{1,\}\.[0-9]\{1,\}\)\.[0-9]\{1,\}/\1/") && export next_version=$major.$((minor+1)) && echo "next version ${next_version}" && sed -i.bak "s/###### version $current_version/###### version $next_version/g" README.md && rm README.md.bak && sed -i.bak "s/^    <version>$current_version<\\/version>/    <version>$next_version<\\/version>/g" pom.xml && rm pom.xml.bak && git status && git commit -am "Travis bot released $next_version" && git tag -a $next_version -m "Automated release" && git remote add target https://${GH_TOKEN}@github.com/groupdocs-viewer/GroupDocs.Viewer-for-Java-Spring.git > /dev/null 2>&1 && git remote -v && git push --set-upstream target release-publishing
  - stage: Release
    if: type = push AND branch = release-publishing AND commit_message =~ /^Travis bot released/
    install: skip
    jdk: oraclejdk8
    script: 'mvn clean package && mkdir -p target/release/DocumentSamples && mkdir -p target/release/Licenses && cp target/viewer-spring-*.jar target/release && cp configuration.yml target/release && cd target && tar -zcvf release.tar.gz release && echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin && docker build -t groupdocs/viewer-for-java-spring . && docker push groupdocs/viewer-for-java-spring'
    deploy:
      provider: releases
      overwrite: true
      skip_cleanup: true
      api_key:
        secure: GfKdL03uJBUm/FIkQgjjmkll/nTL842KWLMJMnZDb8nJ5hJ/V8Rk8HrgbqRHjmH/9sHGCTemvcuT7NqJv89grdFyedVAUqnXkn4zBOxzRf7ccGhxrKYi4G38uNzi1erQs3yJurO1vxNnjBk29392tDQjxV9sXpv25rRPUtamHAFl2T//O89XT+HorlgBwt/Ck3APVM9pM/pl/Dj9w4SgJmuflAF/kYgKRgFr/6th0YgLDJCNvtMaHtprTgzb6eqtbaawKBphngglw/V8NTVet03cqmVMzG0Je75lX8ZMlMYakOhbwG3N1wzmsIsxLWSvuXzwmS4Me4dIq0gQMJ1ilirYPV0GYFynLdd0yRjv4TL9YujhEuE60OsltbkgTPGcwefx1ojb60WP4LcpGjmQRngrgODLv00tWPrAXb6gRY2OAh6lB8YuCNV2es9TeODf9eRbsKvIvGt5YLCXVGbUe0LVuo1qdWePGUy+0LwMMLdpQRi/JT7y7SxiIctEc4NWsLeXr7bvDwGi6j6wr6HidJz92t7B6x7R3334v1XaknSZfn3uPVyOrkBop3bcnhoG5c8ujzjTGnWg8p4+du89i3hWa1WCTIOdvMVBjKPXT+d/V+H7TdEL+Xfi72UP3VUGZRqzei68+NbTJkCj/SoIBzx6o7Le+ab3qLjfL3/wAeA=
      file: target/release.tar.gz
      on:
        repo: groupdocs-viewer/GroupDocs.Viewer-for-Java-Spring
        branch: release-publishing
env:
  global:
  - secure: pezYBJqSNGe9GIAlGriLYNaeW/2f4/l2BsuVpBxSDE2z7rjwzvL1xggxBCnkvBWVcGPPoBpAgO5GVTSR0kZACrF72GcNCCTvMUp5dq19tawiUdr9giDJdowMzL2nAgk9ZXF/JshZI//nfbIC8ZCIZHwdpX0gDsbh4aVTOC9nRyDPaCGDwyHGj9abi9Ord7Kna/62YCqa/QcwtTRTWzms/B9xDKtQDz7AbBjBqgxehTsmjanS6wQKtKLaIxhDY6cL+NZxe0arSlMF/BKLN8wphq1EkuHsvvdaLKMGRKJOBI4j2qkNie6aPalpAxSwEF2A7mFlVSPSHT40R/8JcmbHM4k2HsVSBmEFdmrMyua3zbC3DDD/9U3GPuoQWaLmJpbNUvy2xAbyrVD7uBRS5f6s+ovaF3g+8bjYvVdL9ndnMt+WcOsSx7RKp15M0FlTJTGqnweL1Svp1wm+y3vRmjxVJUNEGj3pYrSALouhe0gbVsnhOnO+wTiscS5RGrHd7htMnUOJTWh5w0+IELmXnO4KkC3Qs9TXwFRcFxHFL2s/wedOjfZ3WDikSevTNa6o32g/MbAGai62fNcFp4VIwpsJ0nQDaTT1TC2Ca5RZBfa2E4X94iPUK5DNEQtXcWjd1NOzeJdvzKLsoSANitKtoaECpvJ6Gt2PO0MapjaKF92OKFk=
  - secure: h7sk+1St4sjL/K3NYIw7LNaxRSf4QZiICXVkCmYpN45ve55kz8qsMscBjqmiMadoCObGJYHM30YurqlMzW1QF4xp8yeuw2xT0VMtY6+XUCXmLpxH96Eo7oc/jWcRp4+PNzHRSTe2gtMjO3r4j7kVQ2UixCZo84GSGRcveXtxrGNI2hDT1qz/ZvCq5EHVeuJ56Gr1wI4RFJSTKJhYsiyYgWcvsQOKJMDgBdX0K8rFfX3TCHflgHjN+n/TlSdMMk0JjV+pItNvL10PStnn0vHUXDkK8GXgbJiux7wxtn8ubPYZKOEY39meDKk5lbihKpuwgBWRsfIJ0dCrlvR9HsO2/HefrhQQJGmRVZNZ58ghdTA8EeuXtvr2ii0UJvTyHDb1922W9ofQknzFTz/GnqvdJloq+FTl359A6rl41Q/q1ZJur/bCTlMigcKVaxTpMUP4+a0OyYSi428iLZHGjOWymhRDVV04rgZ7vxWPPmBykEo/lCMI0ZRH2DVXaLXjWMquIO6rtRZieceKFr04XNYJQgbYg+FYNVc/d1rGArP/IeU3lP4QR51NIJevRuT0fvacV3qSCHHHF1mv7a5e6H8/mIvJ1Qxk33naBxLYj4ksVVUu/xxFDu2BLS6UmkTwgf3a/UQ2/lvN8UPvNFv1dlPLqLlLR5u39phJ9vfcPUp7zeY=
  - secure: PjFaMegP5+oDJN8IdQ9+H85mk6SWK/scpBH0lpHQII35uYVTYobvrewBDonuWdBKwCBB05BfYBIE5rOluDL9bVnN8nC5JNtK2WcNA8a7jmS7nuqVg+B+CUC39fZpLBESS2nTvII97EtTqLbcrBpiRytC8hHChD3ZNptr0QKPGeUPvXfoom5m5wNEH97iDYUI49P7gCFWmGaPRBR3r23FvH1wUika7+xV+mpRU+N4iOZ3EAnsg02tjwgftWFGfoyqT9FJj6PUm5aKCR7ue6ThAaRajtAkr9NnkWlKgJI8FNF8YZqb6LBCxsFCX5qhoaIZEwbgCT6NbGqm5lSr68DcXREulMYa+JOVuh75aZkeTax0cj7c97rZgRD3i5zBVRDtS2KHbihsQLCesBxD/Po4ulwehtRRQmvm7T7D2nPRufHBRZPrmeICFyAOeMlXLv6o/SFAreG3DWH0bNV43dPCYIaZfhv+/PrLQ4VjrM4CSOyUwQUCjg4aIlC2FBMAhkIMqsCIP1rNUWVQSB075fe4mTt5UFF4m1vJZw2gcBCT3JYs/MUh4xRqt4NnC9rUTpcFLGyEXNVTJjA3Lhebb8mzIRhPhVG709UF52Zds/652FaXCeFfDjX9y+yHCuafXUJzsv4eQv5vAlAlqyR8vHFRvgIebikccfSTQP//p3YsUek=
